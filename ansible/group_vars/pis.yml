---
# Common configuration for all Raspberry Pi nodes
# (michael-pi, jim-pi, dwight-pi)

# WiFi stability fix (critical for network reliability)
wifi_power_save_disabled: true

# Debian release management
# Set enabled=true when performing an in-place upgrade
debian_upgrade_enabled: true
debian_upgrade_target_release: trixie
debian_upgrade_target_version: '13'
debian_upgrade_reboot_timeout: 600
debian_upgrade_sources_backup: true

# Firmware management (set enabled=true when applying EEPROM/VL805 updates)
firmware_upgrade_enabled: true
firmware_upgrade_reboot_timeout: 600
firmware_upgrade_packages:
  - rpi-eeprom
  - raspi-config
  # Debian 13 does not ship libraspberrypi-bin (see GH Actions run 19362491035),
  # so we leave it out to keep the firmware role installable on stock Debian.

# DNS configuration (AdGuard on dwight-pi for ad blocking)
dns_servers:
  - 100.100.1.102  # dwight-pi (AdGuard) via Tailscale
  - 1.1.1.1        # Cloudflare fallback
  - 8.8.8.8        # Google fallback

# SSH hardening
ssh_permit_root_login: false
ssh_password_authentication: false

# Tailscale SSH configuration (ensures SSH works after reboots)
tailscale_ssh_enabled: true
tailscale_ssh_tag: "tag:pi"
tailscale_ssh_accept_routes: true
# Routes are host-specific, set in host_vars or inventory

# UFW firewall configuration for Raspberry Pis
ufw_enabled: true
ufw_default_incoming: deny
ufw_default_outgoing: allow
ufw_ssh_rate_limit: true
local_network_cidr: "192.168.1.0/24"
tailscale_network_cidr: "100.100.0.0/16"

# Pi-specific services (DNS, HTTP/HTTPS allowed from local + Tailscale)
ufw_allow_dns: true        # Port 53 (AdGuard/Pi-hole)
ufw_allow_http: true       # Port 80 (k3s ingress)
ufw_allow_https: true      # Port 443 (k3s ingress)

# Base system packages
base_packages:
  - vim
  - curl
  - htop
  - iotop
  - git
  - tmux
