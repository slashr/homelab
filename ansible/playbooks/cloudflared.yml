---
# Deploy cloudflared for Cloudflare Tunnel HA
#
# This playbook installs and configures cloudflared on public nodes to provide
# redundant ingress through Cloudflare Tunnel.
#
# Prerequisites:
#   1. Run Terraform to create the tunnel and get the token:
#      terraform apply (in kubernetes/ directory)
#   2. Get the tunnel token:
#      terraform output -raw cloudflare_tunnel_token
#   3. Store the token in Ansible Vault or pass via environment variable
#
# Usage:
#   ansible-playbook -i ansible/hosts.ini ansible/playbooks/cloudflared.yml \
#     -e "cloudflared_tunnel_token=$CLOUDFLARE_TUNNEL_TOKEN"
#
# Target nodes: pam-amd1, angela-amd2, toby-gcp1
# These are the three public nodes that will run cloudflared for HA.

- name: Deploy cloudflared to pam-amd1
  hosts: pam-amd1
  become: true
  roles:
    - role: ../roles/cloudflared

- name: Deploy cloudflared to angela-amd2
  hosts: angela-amd2
  become: true
  roles:
    - role: ../roles/cloudflared

- name: Deploy cloudflared to toby-gcp1
  hosts: toby-gcp1
  become: true
  roles:
    - role: ../roles/cloudflared
